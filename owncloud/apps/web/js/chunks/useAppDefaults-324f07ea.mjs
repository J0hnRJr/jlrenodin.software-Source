import{u as I,d as S,c as E,b as L}from"./useAuthService-746ac4ed.mjs";import{z as U,a8 as b,a9 as y,a0 as D,a4 as N,$ as P,w as T,a3 as w,t as M,s as _,r as k}from"./useDriveResolver-f387970c.mjs";import{u as q}from"./useStore-acb4016c.mjs";import{E as f,K as e,D as O,ah as $,C as x,ag as R}from"./vendor-2c44cb30.mjs";import{d as H,u as v}from"./eventBus-bf81ca73.mjs";function A({store:t,applicationId:o}){return{applicationMeta:f(()=>{const n=t.getters.apps[o];if(!n)throw new Error(`useAppConfig: could not find config for applicationId: ${o}`);return n||{}})}}function K(t){const o=A(t);return{applicationConfig:f(()=>e(o.applicationMeta).config||{})}}function C({clientService:{webdav:t}}){const o=U(),a=I();return{getUrlForResource:(i,s,r)=>a.webdav.getFileUrl(i,s,{isUrlSigningEnabled:e(o),...r}),revokeUrl:i=>a.webdav.revokeUrl(i),getFileContents:(i,s)=>t.getFileContents(e(e(i).space),{path:e(e(i).item)},{...s}),getFileInfo:(i,s={})=>t.getFileInfo(e(e(i).space),{path:e(e(i).item),fileId:e(e(i).itemId)},s),putFileContents:(i,s)=>t.putFileContents(e(e(i).space),{path:e(e(i).item),...s})}}function z({store:t,currentRoute:o,clientService:a}){const n=O(!1),c=f(()=>t.getters["Files/activeFiles"]),{webdav:m}=a,{replaceInvalidFileRoute:F}=b(),{getFileInfo:p}=C({clientService:a}),i=S();return{isFolderLoading:n,loadFolderForFileContext:async r=>{if(!(t.getters.activeFile&&t.getters.activeFile.path!=="")){n.value=!0,t.commit("Files/CLEAR_CURRENT_FILES_LIST",null);try{r=e(r);const l=e(r.space),u=await p(r,{davProperties:[H.FileId]});F({space:l,resource:u,path:e(r.item),fileId:e(r.itemId)});const d=$(u.path),{resource:g,children:h}=await m.listFiles(l,{path:d});g.type==="file"?t.commit("Files/LOAD_FILES",{currentFolder:g,files:[g]}):t.commit("Files/LOAD_FILES",{currentFolder:g,files:h})}catch(l){if(l.statusCode===401)return i.handleAuthError(e(o));t.commit("Files/SET_CURRENT_FOLDER",null),console.error(l)}n.value=!1}},activeFiles:c}}function B({store:t,applicationId:o,applicationName:a,currentFileContext:n,currentRoute:c}){const m=A({applicationId:o,store:t}),{$gettext:F}=x(),p=f(()=>{var r,l,u;const i=R(e((r=e(n))==null?void 0:r.fileName))||F(((u=(l=e(c))==null?void 0:l.meta)==null?void 0:u.title)||""),s=e(e(m).applicationMeta);return[i,e(a)||s.name||s.id].filter(Boolean)});y({titleSegments:p})}function W(t){var u;const o=E(),a=q(),n=L(),c=(u=t.clientService)!=null?u:I(),m=t.applicationId,F=D({store:a}),p=N("driveAliasAndItem"),{space:i,item:s,itemId:r}=P({store:a,driveAliasAndItem:p}),l=f(()=>{let d;return e(i)?d=v(e(i).webDavPath,e(s)):d=v(e(n).params.filePath),{path:d,driveAliasAndItem:e(p),space:e(i),item:e(s),itemId:e(r),fileName:R(d),routeName:M(e(n).query[_]),...k(e(n).query)}});return B({store:a,applicationId:m,applicationName:t.applicationName,currentFileContext:l,currentRoute:n}),{isPublicLinkContext:F,currentFileContext:l,...K({store:a,...t}),...T({router:o,currentFileContext:l}),...C({clientService:c}),...z({clientService:c,store:a,currentRoute:n}),...w({clientService:c,store:a,currentRoute:e(n)})}}export{W as a,C as b,z as c,K as u};
