import{d as h,c as s,f as y,e as n,t as v,k as d,g as m,o as t,w as $,h as T,E as w,y as P,b5 as I,K as S,j as c,a as f,F as L,i as z,n as C,v as x}from"./chunks/vendor-2c44cb30.mjs";import{_ as g,d as M,u as _,c as N}from"./chunks/eventBus-bf81ca73.mjs";import{a as U}from"./chunks/useAppDefaults-324f07ea.mjs";import{a5 as A,t as D}from"./chunks/useDriveResolver-f387970c.mjs";import"./chunks/useAuthService-746ac4ed.mjs";import"./chunks/useStore-acb4016c.mjs";const F={},j={'"%{appName}" app content area':'Област на съдържанието на приложението "%{appName}".','"%{appName}" app page':'Страница на приложението "%{appName}"',"Error in app server response":"Грешка в отговора на сървъра за приложения","Error retrieving file information":"Грешка при извличането на информацията за файла","Loading app":"Зареждане на приложение","This file is currently being processed and is not yet available for use. Please try again shortly.":"Този файл в момента се обработва и все още не е на разположение за използване. Моля, опитайте отново след малко."},q={'"%{appName}" app content area':'Oblast obsahu aplikace "%{appName}"','"%{appName}" app page':'Stránka aplikace "%{appName}"',"Error in app server response":"Chyba v odpovědi serveru","Error retrieving file information":"Chyba při načítání informací o souboru","Loading app":"Načítání aplikace","This file is currently being processed and is not yet available for use. Please try again shortly.":"Tento soubor se právě zpracovává a zatím není k dispozici pro použití. Zkuste to za chvíli znovu."},B={'"%{appName}" app content area':'"%{appName}" Inhaltsbereich','"%{appName}" app page':'"%{appName}" Anwendungsseite',"Error in app server response":"Fehler in der Antwort des Anwendungsservers","Error retrieving file information":"Datei-Informationen konnten nicht geladen werden.","Loading app":"Lade Anwendung","This file is currently being processed and is not yet available for use. Please try again shortly.":"Diese Datei wird derzeit bearbeitet und kann noch nicht verwendet werden. Bitte in Kürze erneut versuchen."},O={"Error in app server response":"Error en la respuesta del servidor de la app","Loading app":"Cargando app"},V={'"%{appName}" app content area':`Zone de contenu de l'application "%{appName}"`,'"%{appName}" app page':`page de l'application "%{appName}"`,"Error in app server response":"Erreur dans la réponse du serveur","Error retrieving file information":"Erreur lors de la récupération des informations du fichier","Loading app":"Chargement de l'app"},G={},K={'"%{appName}" app content area':"אזור תוכן היישום „%{appName}”",'"%{appName}" app page':"עמוד היישום „%{appName}”","Error in app server response":"שגיאה בתגובת שרת היישום","Error retrieving file information":"שגיאה במשיכת פרטי הקובץ","Loading app":"יישום נטען","This file is currently being processed and is not yet available for use. Please try again shortly.":"הקובץ הזה עובר עיבוד ועדיין אינו זמין לשימוש. נא לנסות שוב בעוד זמן קצר."},R={"Loading app":"Caricamento app"},Z={'"%{appName}" app content area':'"%{appName}" obszar zawartości','"%{appName}" app page':'"%{appName}" strona aplikacji',"Error in app server response":"Błąd odpowiedzi serwera aplikacji","Loading app":"Ładowanie aplikacji"},J={},Y={'"%{appName}" app content area':'Oblasť obsahu "%{appName}"','"%{appName}" app page':'Stránka aplikácie "%{appName}"',"Error in app server response":"Chyba v odpoveda z aplikačného servera","Error retrieving file information":"Chyba pri získavaní informácií o súbore","Loading app":"Načítanie aplikácie"},Q={'"%{appName}" app content area':"Zonë lënde aplikacioni “%{appName}”",'"%{appName}" app page':"Faqe aplikacioni “%{appName}”","Error in app server response":"Gabim në përgjigjen nga shërbyesi i aplikacioneve","Error retrieving file information":"Gabim në marrje hollësish kartele","Loading app":"Po ngarkohet aplikacioni","This file is currently being processed and is not yet available for use. Please try again shortly.":"Kjo kartelë aktualisht po përpunohet dhe s’është ende gati për përdorim. Ju lutemi, riprovoni pas pak."},X={'"%{appName}" app content area':'"%{appName}" uygulama içerik alanı','"%{appName}" app page':'"%{appName}" uygulama sayfası',"Error in app server response":"Uygulama sunucusu yanıtında hata","Error retrieving file information":"Dosya bilgileri alınırken hata oluştu","Loading app":"Uygulama yükleniyor","This file is currently being processed and is not yet available for use. Please try again shortly.":"Bu dosya şu anda işleniyor ve henüz kullanıma uygun değil. Lütfen kısa süre sonra tekrar deneyin."},H={ar:F,bg:j,cs:q,de:B,es:O,fr:V,gl:G,he:K,it:R,pl:Z,ru:J,sk:Y,sq:Q,tr:X},W=h({name:"ErrorScreen",props:{message:{default:"",type:String,required:!1}}}),ee={class:"oc-text-center"},ae={key:0,class:"oc-text-xlarge"};function re(e,r,o,i,p,a){const l=m("oc-icon");return t(),s("div",ee,[y(l,{size:"xxlarge",name:"error-warning","fill-type":"line"}),n(),e.message?(t(),s("p",ae,v(e.message),1)):d("",!0)])}const te=g(W,[["render",re]]),se=h({name:"LoadingScreen"}),ne={class:"oc-text-center"},ie={class:"oc-invisible"};function oe(e,r,o,i,p,a){const l=m("oc-spinner"),u=T("translate");return t(),s("div",ne,[y(l,{size:"xlarge"}),n(),$((t(),s("p",ie,[n("Loading app")])),[[u]])])}const pe=g(se,[["render",oe]]),le=h({name:"ExternalApp",components:{ErrorScreen:te,LoadingScreen:pe},setup(){const e=A("app"),r=w(()=>D(S(e)));return{...U({applicationId:"external",applicationName:r}),applicationName:r}},data:()=>({loading:!1,loadingError:!1,errorMessage:"",appUrl:"",method:"",formParameters:{}}),computed:{...P(["capabilities"]),pageTitle(){const e=this.$gettext('"%{appName}" app page');return this.$gettextInterpolate(e,{appName:this.applicationName})},iFrameTitle(){const e=this.$gettext('"%{appName}" app content area');return this.$gettextInterpolate(e,{appName:this.applicationName})},fileId(){return this.$route.query.fileId}},async created(){var e;this.loading=!0;try{const r=this.fileId||(await this.getFileInfo(this.currentFileContext,{davProperties:[M.FileId]})).fileId,o=_(N.serverUrl,this.capabilities.files.app_providers[0].open_url),i=I.stringify({file_id:r,lang:this.$language.current,...this.applicationName&&{app_name:this.applicationName}}),p=`${o}?${i}`,a=await this.makeRequest("POST",p,{validateStatus:()=>!0});if(a.status!==200){switch(a.status){case 425:this.errorMessage=this.$gettext("This file is currently being processed and is not yet available for use. Please try again shortly.");break;default:this.errorMessage=(e=a.data)==null?void 0:e.message}this.loading=!1,this.loadingError=!0,console.error("Error fetching app information",a.status,a.data.message);return}if(!a.data.app_url||!a.data.method){this.errorMessage=this.$gettext("Error in app server response"),this.loading=!1,this.loadingError=!0,console.error("Error in app server response");return}this.appUrl=a.data.app_url,this.method=a.data.method,a.data.form_parameters&&(this.formParameters=a.data.form_parameters),this.method==="POST"&&this.formParameters&&this.$nextTick(()=>this.$refs.subm.click()),this.loading=!1}catch(r){this.errorMessage=this.$gettext("Error retrieving file information"),console.error("Error retrieving file information",r),this.loading=!1,this.loadingError=!0}}}),ce=["textContent"],de=["src","title"],me={key:3,class:"oc-height-1-1"},ue=["action"],he=["value"],ge=["name","value"],fe=["title"];function ye(e,r,o,i,p,a){const l=m("loading-screen"),u=m("error-screen");return t(),s("main",{class:C(["oc-height-1-1",{"oc-flex oc-flex-center oc-flex-middle":e.loading||e.loadingError}])},[c("h1",{class:"oc-invisible-sr",textContent:v(e.pageTitle)},null,8,ce),n(),e.loading?(t(),f(l,{key:0})):e.loadingError?(t(),f(u,{key:1,message:e.errorMessage},null,8,["message"])):d("",!0),n(),e.appUrl&&e.method==="GET"?(t(),s("iframe",{key:2,src:e.appUrl,class:"oc-width-1-1 oc-height-1-1",title:e.iFrameTitle,allowfullscreen:""},null,8,de)):d("",!0),n(),e.appUrl&&e.method==="POST"&&e.formParameters?(t(),s("div",me,[c("form",{action:e.appUrl,target:"app-iframe",method:"post"},[c("input",{ref:"subm",type:"submit",value:e.formParameters,class:"oc-hidden"},null,8,he),n(),(t(!0),s(L,null,z(e.formParameters,(b,E,k)=>(t(),s("div",{key:k},[c("input",{name:E,value:b,type:"hidden"},null,8,ge)]))),128))],8,ue),n(),c("iframe",{name:"app-iframe",class:"oc-width-1-1 oc-height-1-1",title:e.iFrameTitle,allowfullscreen:""},null,8,fe)])):d("",!0)],2)}const ve=g(le,[["render",ye]]),_e={mimeTypes:[]},Ne={async fetchMimeTypes({rootGetters:e,commit:r}){var a;if(!((a=e.capabilities.files.app_providers[0])!=null&&a.enabled))return;const o=_(N.serverUrl,e.capabilities.files.app_providers[0].apps_url),i=await fetch(o,{headers:{"X-Request-ID":x()}});if(!i.ok)throw new Error("Error fetching app provider MIME types");const{"mime-types":p}=await i.json();r("SET_MIME_TYPES",p)}},be={mimeTypes:e=>e.mimeTypes},Ee={SET_MIME_TYPES(e,r){e.mimeTypes=r}},ke={namespaced:!0,state:_e,actions:Ne,mutations:Ee,getters:be},$e={name:"External",id:"external"},Te=[{name:"apps",path:"/:driveAliasAndItem(.*)?",component:ve,meta:{authContext:"hybrid",patchCleanPath:!0}}],Ce={appInfo:$e,routes:Te,store:ke,translations:H,ready({store:e}){e.dispatch("External/fetchMimeTypes")}};export{Ce as default};
