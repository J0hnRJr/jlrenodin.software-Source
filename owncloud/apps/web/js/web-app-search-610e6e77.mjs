import{v as P,a as y,L as z}from"./chunks/List-2f7d1eb7.mjs";import{d as R,D as N,aY as q,G as T,aZ as U,q as A,K,c as i,f as l,ac as p,e as c,w as F,a as k,b as h,g as n,h as M,o as r,j as m,t as v,F as g,i as S,k as O,n as L,M as j}from"./chunks/vendor-2c44cb30.mjs";import{u as Z}from"./chunks/useStore-acb4016c.mjs";import{e as u,_}from"./chunks/eventBus-bf81ca73.mjs";import{u as W}from"./chunks/useUserContext-8e0854d8.mjs";const V=R({name:"SearchBar",setup(){const e=Z(),t=N(!1),s=q("isMobileWidth");return T(s,()=>{const a=document.getElementById("files-global-search-bar"),w=!!document.querySelector('.tippy-box[data-state="visible"]');K(s)?w?(a.style.visibility="visible",t.value=!0):(a.style.visibility="hidden",t.value=!1):(a.style.visibility="visible",t.value=!1)}),{isUserContext:W({store:e}),showCancelButton:t}},data(){return{term:"",activeProvider:void 0,optionsVisible:!1,markInstance:null,activePreviewIndex:null,debouncedSearch:void 0,providerStore:P,loading:!1,searchResults:[],hideOptionsDropEvent:null,clearTermEvent:null}},computed:{showNoResults(){return this.searchResults.every(({result:e})=>!e.values.length)},availableProviders(){return this.providerStore.availableProviders},isSearchBarEnabled(){return this.availableProviders.length&&this.isUserContext},displayProviders(){return this.availableProviders.filter(e=>this.getSearchResultForProvider(e).values.length)},searchLabel(){return this.$gettext("Enter search term")},optionsDrop(){return this.$refs.optionsDrop}},watch:{term(){this.debouncedSearch(this)},searchResults:{handler(){this.activePreviewIndex=null,this.$nextTick(()=>{this.showNoResults||this.optionsDrop&&(this.markInstance=new U(this.optionsDrop.$refs.drop),this.markInstance.unmark(),this.markInstance.mark(this.term,{element:"span",className:"highlight-mark",exclude:[".provider-details *"]}))})},deep:!0},$route:{handler(e){this.$nextTick(()=>{var a;if(!this.availableProviders.length)return;const t=(a=e==null?void 0:e.query)==null?void 0:a.term,s=this.$el.getElementsByTagName("input")[0];!s||!t||(this.term=t,s.value=t)})},immediate:!0}},created(){this.debouncedSearch=A(this.search,500),this.clearTermEvent=u.subscribe("app.search.term.clear",()=>{this.term=""}),this.hideOptionsDropEvent=u.subscribe("app.search.options-drop.hide",()=>{this.optionsDrop.hide()})},beforeUnmount(){u.unsubscribe("app.search.term.clear",this.clearTermEvent),u.unsubscribe("app.search.options-drop.hide",this.hideOptionsDropEvent)},methods:{async showPreview(){this.term&&(this.optionsDrop.show(),await this.search())},async search(){var e;if(this.searchResults=[],!!this.term){this.loading=!0;for(const t of this.availableProviders)(e=t.previewSearch)!=null&&e.available&&this.searchResults.push({providerId:t.id,result:await t.previewSearch.search(this.term)});this.loading=!1}},onClear(){this.term="",this.optionsDrop.hide()},onKeyUpEnter(){this.optionsDrop.hide(),this.term&&this.activePreviewIndex===null&&this.$router.push(y("files-common-search",{query:{term:this.term,provider:"files.sdk"}})),this.activePreviewIndex!==null&&this.optionsDrop.$el.querySelectorAll(".preview")[this.activePreviewIndex].firstChild.click()},onKeyUpUp(){const e=this.optionsDrop.$el.querySelectorAll(".preview").length;e&&(this.activePreviewIndex===null?this.activePreviewIndex=e-1:this.activePreviewIndex=this.activePreviewIndex===0?null:this.activePreviewIndex-1,this.scrollToActivePreviewOption())},onKeyUpDown(){const e=this.optionsDrop.$el.querySelectorAll(".preview").length;e&&(this.activePreviewIndex===null?this.activePreviewIndex=0:this.activePreviewIndex=this.activePreviewIndex===e-1?null:this.activePreviewIndex+1,this.scrollToActivePreviewOption())},scrollToActivePreviewOption(){if(typeof this.optionsDrop.$el.scrollTo!="function")return;const e=this.optionsDrop.$el.querySelectorAll(".preview");this.optionsDrop.$el.scrollTo(0,this.activePreviewIndex===null?0:e[this.activePreviewIndex].getBoundingClientRect().y-e[this.activePreviewIndex].getBoundingClientRect().height)},updateTerm(e){return this.term=e,this.term?this.optionsDrop.show():this.optionsDrop.hide()},getSearchResultForProvider(e){var t;return(t=this.searchResults.find(({providerId:s})=>s===e.id))==null?void 0:t.result},getMoreResultsLinkForProvider(e){return y("files-common-search",{query:{term:this.term,provider:e.id}})},getMoreResultsDetailsTextForProvider(e){const t=this.getSearchResultForProvider(e);if(!t||!t.totalResults)return this.$gettext("Show all results");const s=this.$ngettext("Show %{totalResults} result","Show %{totalResults} results",t.totalResults);return this.$gettextInterpolate(s,{totalResults:t.totalResults})},isPreviewElementActive(e){var s,a;return((a=(s=this.optionsDrop.$el.querySelectorAll(".preview")[this.activePreviewIndex])==null?void 0:s.dataset)==null?void 0:a.searchId)===e},showSearchBar(){document.getElementById("files-global-search-bar").style.visibility="visible",document.getElementsByClassName("oc-search-input")[0].focus(),this.showCancelButton=!0},cancelSearch(){document.getElementById("files-global-search-bar").style.visibility="hidden",this.showCancelButton=!1},hideOptionsDrop(){this.optionsDrop.hide()}}});const H={key:0,id:"files-global-search",ref:"searchBar",class:"oc-flex","data-custom-key-bindings":"true"},G={key:0,class:"loading spinner oc-flex oc-flex-center oc-flex-middle oc-text-muted"},J={class:"oc-ml-s"},Q={key:1,id:"no-results",class:"oc-flex oc-flex-center"},Y={class:"oc-text-truncate oc-flex oc-flex-between oc-text-muted provider-details"},X=["textContent"],ee={key:0},te=["data-search-id"],se={key:1};function re(e,t,s,a,w,D){const b=n("oc-search-bar"),C=n("oc-icon"),E=n("oc-button"),x=n("oc-spinner"),$=n("router-link"),f=n("oc-list"),I=n("oc-drop"),B=M("oc-tooltip");return e.isSearchBarEnabled?(r(),i("div",H,[l(b,{id:"files-global-search-bar",ref:"search",label:e.searchLabel,"type-ahead":!0,value:e.term,placeholder:e.searchLabel,"button-hidden":!0,"show-cancel-button":e.showCancelButton,"cancel-button-variation":"brand","cancel-button-appearance":"raw-inverse","cancel-handler":e.cancelSearch,onInput:e.updateTerm,onClear:e.onClear,onClick:e.showPreview,onKeyup:[p(e.hideOptionsDrop,["esc"]),p(e.onKeyUpUp,["up"]),p(e.onKeyUpDown,["down"]),p(e.onKeyUpEnter,["enter"])]},null,8,["label","value","placeholder","show-cancel-button","cancel-handler","onInput","onClear","onClick","onKeyup"]),c(),F((r(),k(E,{"aria-label":e.$gettext("Click to display and focus the search bar"),class:"mobile-search-btn oc-mr-s",appearance:"raw-inverse",variation:"brand",onClick:e.showSearchBar},{default:h(()=>[l(C,{name:"search","fill-type":"line"})]),_:1},8,["aria-label","onClick"])),[[B,e.$gettext("Display search bar")]]),c(),l(I,{id:"files-global-search-options",ref:"optionsDrop",mode:"manual",target:"#files-global-search-bar"},{default:h(()=>[l(f,{class:"oc-list-divider"},{default:h(()=>[e.loading?(r(),i("li",G,[l(x,{size:"small","aria-hidden":!0,"aria-label":""}),c(),m("span",J,v(e.$gettext("Searching ...")),1)])):e.showNoResults?(r(),i("li",Q,v(e.$gettext("No results")),1)):(r(!0),i(g,{key:2},S(e.displayProviders,o=>(r(),i("li",{key:o.id,class:"provider"},[l(f,null,{default:h(()=>[m("li",Y,[m("span",{class:"display-name",textContent:v(e.$gettext(o.displayName))},null,8,X),c(),o.listSearch?(r(),i("span",ee,[l($,{class:"more-results",to:e.getMoreResultsLinkForProvider(o),onClick:e.hideOptionsDrop},{default:h(()=>[m("span",null,v(e.getMoreResultsDetailsTextForProvider(o)),1)]),_:2},1032,["to","onClick"])])):O("",!0)]),c(),(r(!0),i(g,null,S(e.getSearchResultForProvider(o).values,d=>(r(),i("li",{key:d.id,"data-search-id":d.id,class:L([{active:e.isPreviewElementActive(d.id)},"preview oc-flex oc-flex-middle"])},[(r(),k(j(o.previewSearch.component),{class:"preview-component",provider:o,"search-result":d,onClick:e.hideOptionsDrop},null,8,["provider","search-result","onClick"]))],10,te))),128))]),_:2},1024)]))),128))]),_:1})]),_:1},512)],512)):(r(),i("div",se))}const ae=_(V,[["render",re]]),ie=R({name:"Search"}),oe={id:"search",class:"oc-flex oc-height-1-1"};function le(e,t,s,a,w,D){const b=n("router-view");return r(),i("main",oe,[l(b,{id:"search-view"})])}const ne=_(ie,[["render",le]]),ce={"Enter search term":"أدخل مصطلح للبحث",Search:"بحث"},he={"Click to display and focus the search bar":"Натиснете, за да се покаже и фокусира лентата за търсене","Display search bar":"Показване на лентата за търсене","Enter search term":"Въведете термин за търсене","No results":"Няма резултати",Search:"Търсене","Searching ...":"Търсене ...","Show %{totalResults} result":["Показване на %{totalResults} резултат","Показване на %{totalResults} резултата"],"Show all results":"Показване на всички резултати"},ue={"Click to display and focus the search bar":"Kliknutím zobrazíte a zaměříte vyhledávací panel","Display search bar":"Zobrazit vyhledávací lištu","Enter search term":"Zadejte hledaný výraz","No results":"Žádné výsledky",Search:"Hledat","Searching ...":"Hledání ...","Show %{totalResults} result":["Ukázat %{totalResults} výsledek","Ukázat %{totalResults} výsledky","Ukázat %{totalResults} výsledků","Ukázat %{totalResults} výsledků"],"Show all results":"Ukázat všechny výsledky"},de={"Click to display and focus the search bar":"Klicken, um die Suchleiste anzuzeigen und zu fokussieren","Display search bar":"Suchleiste anzeigen","Enter search term":"Suchbegriff eingeben","No results":"Keine Ergebnisse",Search:"Suchen","Searching ...":"Suche...","Show %{totalResults} result":["Zeige %{totalResults} Ergebnisse","Zeige %{totalResults} Ergebnisse"],"Show all results":"Zeige alle Ergebnisse"},pe={"Display search bar":"Mostrar barra de búsqueda","Enter search term":"Introduzca termino de búsqueda","No results":"Sin resultados",Search:"Buscar","Searching ...":"Buscando ...","Show all results":"Mostrar todos los resultados"},me={"Enter search term":"Saisissez le terme à rechercher",Search:"Recherche"},ve={Search:"Buscar"},we={"Click to display and focus the search bar":"לחיצה תציג ותעביר את המיקוד לסרגל החיפוש","Display search bar":"הצגת סרגל חיפוש","Enter search term":"נא למלא ביטוי לחיפוש","No results":"אין תוצאות",Search:"חיפוש","Searching ...":"מתבצע חיפוש…","Show %{totalResults} result":["הצגת תוצאה","הצגת %{totalResults} תוצאות","הצגת %{totalResults} תוצאות","הצגת %{totalResults} תוצאות"],"Show all results":"הצגת כל התוצאות"},be={Search:"Cerca"},fe={"Click to display and focus the search bar":"Kliknij aby wyświetlić i użyć paska wyszukiwarki","Display search bar":"Wyświetlanie paska wyszukiwarki","Enter search term":"Wpisz treść do wyszukania","No results":"Brak wyników",Search:"Szukaj","Searching ...":"Wyszukiwanie ...","Show %{totalResults} result":["Pokaż %{totalResults} wynik","Pokaż %{totalResults} wyniki","Pokaż %{totalResults} wyników","Pokaż %{totalResults} wyników"],"Show all results":"Pokaż wszystkie wyniki"},ye={"Click to display and focus the search bar":"Нажмите, чтобы отобразить и перейти к строке поиска","Display search bar":"Показать строку поиска","Enter search term":"Введите поисковый запрос","No results":"Нет результатов",Search:"Найти","Searching ...":"Поиск ...","Show all results":"Показать все результаты"},ke={"Enter search term":"Zadajte hľadaný text"},ge={"Click to display and focus the search bar":"Klikoni që të shfaqet shtylla e kërkimeve dhe fokusi të kalohet në të","Display search bar":"Shfaq shtyllë kërkimesh","Enter search term":"Jepni term kërkim","No results":"Pa përfundime",Search:"Kërko","Searching ...":"Po kërkohet …","Show %{totalResults} result":["Shfaq %{totalResults} përfundim","Shfaq %{totalResults} përfundime"],"Show all results":"Shfaqi krejt përfundimet"},Se={"Click to display and focus the search bar":"Arama çubuğunu görüntülemek ve odaklamak için tıklayın","Display search bar":"Arama çubuğunu görüntüle","Enter search term":"Arama terimi gir","No results":"Sonuç yok",Search:"Ara","Searching ...":"Aranıyor ...","Show %{totalResults} result":["%{totalResults} sonucu göster","%{totalResults} sonucu göster"],"Show all results":"Tüm sonuçları göster"},Pe={ar:ce,bg:he,cs:ue,de,es:pe,fr:me,gl:ve,he:we,it:be,pl:fe,ru:ye,sk:ke,sq:ge,tr:Se},Re=e=>e;u.subscribe("app.search.register.provider",e=>{P.addProvider(e)});const $e={appInfo:{name:Re("Search"),id:"search",icon:"folder"},routes:[{name:"search",path:"/",component:ne,children:[{name:"provider-list",path:"list/:page?",component:z,meta:{authContext:"user",contextQueryItems:["term","provider"]}}]}],translations:Pe,mounted({portal:e}){e.open("runtime","header",1,[ae])}};export{$e as default};
