import{d as I,D as m,C as G,H as C,G as Z,E as u,I as W,T as Q,K as a,U as ee,bm as te,bl as oe,g,o as h,c as y,f as w,b as O,a as ae,k as _,e as K,j as N,n as ie}from"./chunks/vendor-2c44cb30.mjs";import{d as D,i as U,_ as ne}from"./chunks/eventBus-bf81ca73.mjs";import{a as se}from"./chunks/useAppDefaults-324f07ea.mjs";import{u as re}from"./chunks/useStore-acb4016c.mjs";import{o as le}from"./chunks/useDriveResolver-f387970c.mjs";import{A as de}from"./chunks/AppTopBar-d00b7bc4.mjs";import"./chunks/useAuthService-746ac4ed.mjs";const ue=I({name:"TextEditor",components:{AppTopBar:de},beforeRouteLeave(e,i,o){if(this.isDirty){const n={variation:"danger",icon:"warning",title:this.$gettext("Unsaved changes"),message:this.$gettext("Your changes were not saved. Do you want to save them?"),cancelText:this.$gettext("Don't Save"),confirmText:this.$gettext("Save"),onCancel:()=>{this.hideModal(),o()},onConfirm:async()=>{await this.save(),this.hideModal(),o()}};this.createModal(n)}else o()},setup(){const e=se({applicationId:"text-editor"}),{applicationConfig:i,currentFileContext:o,getFileInfo:n,getFileContents:p,putFileContents:k,replaceInvalidFileRoute:P}=e,f=m(),s=m(),v=m(),b=m(!0),l=m(),S=re(),{$gettext:d,interpolate:H}=G();let E=null;const c=t=>{S.dispatch("showMessage",{title:d("An error occurred"),desc:t,status:"danger"})},B=()=>{S.dispatch("showMessage",{title:d("File autosaved")})},M=C(function*(){l.value=yield n(o,{davProperties:[D.FileId,D.Permissions,D.Name]}),P(o,a(l)),b.value=![U.Updateable,U.FileUpdateable].some(r=>(l.value.permissions||"").indexOf(r)>-1);const t=yield p(o);f.value=s.value=t.body,v.value=t.headers["OC-ETag"]}).restartable(),A=C(function*(){const t=a(s);try{const r=yield k(o,{content:t,previousEntityTag:a(v)});f.value=t,v.value=r.etag}catch(r){switch(r.statusCode){case 412:c(d("This file was updated outside this window. Please refresh the page (all changes will be lost)."));break;case 500:c(d("Error when contacting the server"));break;case 507:const F=S.getters["runtime/spaces/spaces"].find(J=>J.id===a(l).storageId&&le(J));if(F){c(H(d('There is not enough quota on "%{spaceName}" to save this file'),{spaceName:F.name}));break}c(d("There is not enough quota to save this file"));break;case 401:c(d("You're not authorized to save this file"));break;default:c(r.message||r)}}}).restartable();Z(o,()=>{M.perform()},{immediate:!0});const X=u(()=>a(s)&&j?te(oe(a(s))):null),x=u(()=>a(f)!==a(s)),$=u(()=>M.isError),R=u(()=>M.isRunning),j=u(()=>a(V)==="md"||!a(Y).showPreviewOnlyMd),V=u(()=>a(a(o).path).split(".").pop()),Y=u(()=>{const{showPreviewOnlyMd:t=!0}=a(i);return{showPreviewOnlyMd:t}});W(()=>{document.addEventListener("keydown",z,!1),window.addEventListener("beforeunload",T);const t=S.getters.configuration.options.editor;t.autosaveEnabled&&(E=setInterval(()=>{x.value&&L().then(r=>B())},(t.autosaveInterval||120)*1e3))}),Q(()=>{window.removeEventListener("beforeunload",T),document.removeEventListener("keydown",z,!1),clearInterval(E)});const L=async function(){await A.perform()},z=function(t){(t.ctrlKey||t.metaKey)&&t.code==="KeyS"&&(t.preventDefault(),L())},T=function(t){a(x)&&(t.preventDefault(),t.returnValue="")};return{...e,loadFileTask:M,saveFileTask:A,isLoading:R,isError:$,showPreview:j,isDirty:x,isReadOnly:b,currentContent:s,renderedMarkdown:X,config:Y,resource:l,save:L,handleSKey:z,handleUnload:T}},methods:{...ee(["createModal","hideModal"])}});const ce={id:"text-editor",class:"oc-height-1-1"},he={key:0,class:"oc-text-center"},pe={key:1,class:"oc-text-center"},fe={class:"oc-position-center oc-text-center"},ve={key:2,class:"oc-flex editor-wrapper-height oc-px-s oc-pt-rm oc-pb-s"},me={key:0,class:"oc-container oc-width-1-2"},ge=["innerHTML"];function ye(e,i,o,n,p,k){const P=g("oc-icon"),f=g("oc-button"),s=g("app-top-bar"),v=g("oc-spinner"),b=g("oc-textarea");return h(),y("main",ce,[w(s,{resource:e.resource,onClose:e.closeApp},{right:O(()=>[e.isLoading?_("",!0):(h(),ae(f,{key:0,id:"text-editor-controls-save","aria-label":e.$gettext("Save"),disabled:e.isReadOnly||!e.isDirty,onClick:e.save},{default:O(()=>[w(P,{name:"save",size:"small"})]),_:1},8,["aria-label","disabled","onClick"]))]),_:1},8,["resource","onClose"]),K(),e.isLoading?(h(),y("div",he,[w(v,{"aria-label":e.$gettext("Loading editor content")},null,8,["aria-label"])])):e.isError?(h(),y("div",pe,[N("div",fe,[w(P,{size:"xxlarge",name:"error-warning","fill-type":"line"})])])):(h(),y("div",ve,[N("div",{class:ie([e.showPreview?"oc-width-1-2":"oc-width-1-1","oc-height-1-1"])},[w(b,{id:"text-editor-input",modelValue:e.currentContent,"onUpdate:modelValue":i[0]||(i[0]=l=>e.currentContent=l),name:"input","full-width":"",label:"",class:"oc-height-1-1",rows:20,disabled:e.isReadOnly},null,8,["modelValue","disabled"])],2),K(),e.showPreview?(h(),y("div",me,[N("div",{id:"text-editor-preview",innerHTML:e.renderedMarkdown},null,8,ge)])):_("",!0)]))])}const we=ne(ue,[["render",ye]]),ke={"Loading editor content":"تحميل محتوى المحرر",Save:"حفظ"},Pe={"An error occurred":"Възникна грешка","Don't Save":"Без запазване","Error when contacting the server":"Грешка при свързване със сървъра","File autosaved":"Файлът е автоматично запазен","JavaScript file":"JavaScript файл","JSON file":"JSON файл","Loading editor content":"Зареждане на съдържанието в редактора","Markdown file":"Markdown файл","PHP file":"PHP файл","Plain text file":"Обикновен текстови файл","Python file":"Python файл",Save:"Запазване","Text Editor":"Текстов редактор",'There is not enough quota on "%{spaceName}" to save this file':'Квотата в "%{spaceName}" не е достатъчна за запазването на този файл',"There is not enough quota to save this file":"Няма достатъчно квота за запазване на този файл","This file was updated outside this window. Please refresh the page (all changes will be lost).":"Този файл е актуализиран извън този прозорец. Моля, презаредете страницата (всички промени ще бъдат загубени).","Unsaved changes":"Промените не са запазени","XML file":"XML файл","YAML file":"YAML файл","You're not authorized to save this file":"Не сте упълномощени да запазите този файл","Your changes were not saved. Do you want to save them?":"Промените ви не са запазени. Искате ли да ги запазите?"},be={"An error occurred":"Objevila se chyba","Don't Save":"Neukládat","Error when contacting the server":"Chyba při kontaktování serveru","File autosaved":"Soubor automaticky uložen","JavaScript file":"JavaScript soubor","JSON file":"JSON soubor","Loading editor content":"Načítání obsahu editoru","Markdown file":"Markdown soubor","PHP file":"PHP soubor","Plain text file":"Prostý textový soubor","Python file":"Python soubor",Save:"Uložit","Text Editor":"Textový editor",'There is not enough quota on "%{spaceName}" to save this file':'Na "%{spaceName}" není dostatečná kvóta pro uložení tohoto souboru',"There is not enough quota to save this file":"K uložení tohoto souboru není dostatečná kvóta","This file was updated outside this window. Please refresh the page (all changes will be lost).":"Tento soubor byl aktualizován mimo toto okno. Obnovte prosím stránku (všechny změny budou ztraceny).","Unsaved changes":"Neuložené změny","XML file":"XML soubor","YAML file":"YAML soubor","You're not authorized to save this file":"K uložení tohoto souboru nemáte oprávnění","Your changes were not saved. Do you want to save them?":"Změny nebyly uloženy. Chcete je uložit?"},Se={"An error occurred":"Ein Fehler ist aufgetreten.","Don't Save":"Verwerfen","Error when contacting the server":"Fehler beim Kontaktieren des Servers","File autosaved":"Datei automatisch gespeichert!","JavaScript file":"JavaScript-Datei","JSON file":"JSON-Datei","Loading editor content":"Lade Editor- Inhalt","Markdown file":"Markdown-Datei","PHP file":"PHP-Datei","Plain text file":"Text-Datei","Python file":"Python-Datei",Save:"Speichern","Text Editor":"Texteditor",'There is not enough quota on "%{spaceName}" to save this file':'Das Kontingent für "%{spaceName}" ist nicht ausreichend, um die Datei zu speichern.',"There is not enough quota to save this file":"Das Kontingent ist nicht ausreichend, um die Datei zu speichern.","This file was updated outside this window. Please refresh the page (all changes will be lost).":"Die Datei wurde außerhalb des Fensters aktualisiert. Bitte die Seite neu laden (alle Änderungen gehen verloren).","Unsaved changes":"Ungespeicherte Änderungen","XML file":"XML-Datei","YAML file":"YAML-Datei","You're not authorized to save this file":"Keine ausreichenden Berechtigungen für das Speichern der Datei ","Your changes were not saved. Do you want to save them?":"Ungesicherte Änderungen vorhanden. Speichern? "},Me={"An error occurred":"Ocurrió un error","File autosaved":"Archivo auto-guardado","Loading editor content":"Cargando el editor de contenido",Save:"Guardar","You're not authorized to save this file":"Usted no tiene autorización a guardar este archivo."},xe={"An error occurred":"Une erreur est survenue","Don't Save":"Ne pas enregistrer","Error when contacting the server":"Erreur de communication avec le serveur","JavaScript file":"Fichier JavaScript","JSON file":"Fichier JSON","Loading editor content":"Chargement du contenu de l'éditeur","Markdown file":"Fichier Markdown","PHP file":"Fichier PHP","Plain text file":"Fichier texte brut","Python file":"Fichier Python",Save:"Sauvegarder","Text Editor":"Éditeur de texte","This file was updated outside this window. Please refresh the page (all changes will be lost).":"Ce fichier a été modifié en dehors de cette fenêtre. Veuillez rafraîchir la page (tous les changements seront perdus).","Unsaved changes":"Modifications non enregistrées","XML file":"Fichier XML","YAML file":"Fichier YAML","You're not authorized to save this file":"Vous n'êtes pas autorisé à enregistrer ce fichier","Your changes were not saved. Do you want to save them?":"Les modifications n'ont pas été enregistrées, souhaitez-vous les enregistrer ?"},Le={Save:"Gardar"},ze={"An error occurred":"אירעה שגיאה","Don't Save":"לא לשמור","Error when contacting the server":"שגיאה ביצירת קשר עם השרת","File autosaved":"הקובץ נשמר אוטומטית","JavaScript file":"קובץ JavaScript","JSON file":"קובץ JSON","Loading editor content":"תוכן העורך נטען","Markdown file":"קובץ Markdown","PHP file":"קובץ PHP","Plain text file":"קובץ טקסט פשוט","Python file":"קובץ Python",Save:"שמירה","Text Editor":"עורך טקסט",'There is not enough quota on "%{spaceName}" to save this file':"אין מספיק מכסה על גבי „%{spaceName}” כדי לשמור את הקובץ הזה","There is not enough quota to save this file":"אין מספיק מכסה כדי לשמור את הקובץ הזה","This file was updated outside this window. Please refresh the page (all changes will be lost).":"קובץ זה עודכן מחוץ לחלון. נא לעדכן את העמוד (כל השינויים יאבדו).","Unsaved changes":"שינויים שלא נשמרו","XML file":"קובץ XML","YAML file":"קובץ YAML","You're not authorized to save this file":"אין לך הרשאה לשמור את הקובץ הזה","Your changes were not saved. Do you want to save them?":"השינויים שלך לא נשמרו. לשמור אותם?"},Te={},Ne={"An error occurred":"Wystąpił błąd","Don't Save":"Nie zapisuj","Error when contacting the server":"Błąd połączenia z serwerem","File autosaved":"Plik zapisany automatycznie","JavaScript file":"Plik JavaScript","JSON file":"Plik JSON","Loading editor content":"Ładowanie treści do edycji","Markdown file":"Plik z formatowaniem Markdown","PHP file":"Plik PHP","Plain text file":"Zwykły plik tekstowy","Python file":"Plik Python",Save:"Zapisz","Text Editor":"Edytor tekstu",'There is not enough quota on "%{spaceName}" to save this file':"Nie ma wystarczającej ilości miejsca na %{spaceName}, aby zapisać ten plik","There is not enough quota to save this file":"Nie ma wystarczającej ilości miejsca, aby zapisać ten plik","This file was updated outside this window. Please refresh the page (all changes will be lost).":"Ten plik został zaktualizowany poza tym oknem. Odśwież stronę (wszystkie zmiany zostaną utracone).","Unsaved changes":"Niezapisane zmiany","XML file":"Plik XML","YAML file":"Plik YAML","You're not authorized to save this file":"Nie masz uprawnień do zapisu tego pliku","Your changes were not saved. Do you want to save them?":"Twoje zmiany nie są zapisane. Czy chcesz je zapisać?"},De={"An error occurred":"Произошла ошибка",Save:"Сохранить","Unsaved changes":"Несохраненные изменения"},Ee={"Loading editor content":"Načítanie obsahu editora",Save:"Uložiť","Unsaved changes":"Neuložené zmeny"},Ae={"An error occurred":"Ndodhi një gabim","Don't Save":"Mos e Ruaj","Error when contacting the server":"Gabim kur kontaktohej shërbyesi","File autosaved":"Kartela u ruajt automatikisht","JavaScript file":"Kartelë JavaScript","JSON file":"Kartelë JSON","Loading editor content":"Po ngarkohet përpunues lënde","Markdown file":"Kartelë Markdown","PHP file":"Kartelë PHP","Plain text file":"Kartelë tekst i thjeshtë","Python file":"Kartelë Python",Save:"Ruaje","Text Editor":"Përpunues Tekstesh",'There is not enough quota on "%{spaceName}" to save this file':"S’ka kuota të mjaftueshme te “%{spaceName}” për të ruajtur këtë kartelë","There is not enough quota to save this file":"S’ka kuota të mjaftueshme për të ruajtur këtë kartelë","This file was updated outside this window. Please refresh the page (all changes will be lost).":"Kjo kartelë qe përditësuar jashtë kësaj dritareje. Ju lutemi, rifreskoni faqen (do të humbin krejt ndryshimet).","Unsaved changes":"Ndryshime të paruajtura","XML file":"Kartelë XML","YAML file":"Kartelë YAML","You're not authorized to save this file":"S’jeni i autorizuar të ruani këtë kartelë","Your changes were not saved. Do you want to save them?":"Ndryshimet tuaja s’u ruajtën. Doni të ruhen?"},je={"An error occurred":"Bir hata oluştu","Don't Save":"Kaydetme","Error when contacting the server":"Sunucuyla iletişim kurulurken hata","File autosaved":"Dosya otomatik olarak kaydedildi","JavaScript file":"JavaScript dosyası","JSON file":"JSON dosyası","Loading editor content":"Editör içeriği yükleniyor","Markdown file":"Markdown dosyası","PHP file":"PHP dosyası","Plain text file":"Düz metin dosyası","Python file":"Python dosyası",Save:"Kaydet","Text Editor":"Metin Editörü",'There is not enough quota on "%{spaceName}" to save this file':'Bu dosyayı kaydetmek için "%{spaceName}" üzerinde yeterli kota yok',"There is not enough quota to save this file":"Bu dosyayı kaydetmek için yeterli kota yok","This file was updated outside this window. Please refresh the page (all changes will be lost).":"Bu dosya, bu pencerenin dışında güncellendi. Lütfen sayfayı yenileyin (tüm değişiklikler kaybolacak).","Unsaved changes":"Kaydedilmeyen değişiklikler","XML file":"XML dosyası","YAML file":"YAML dosyası","You're not authorized to save this file":"Bu dosyayı kaydetme yetkiniz yok","Your changes were not saved. Do you want to save them?":"Değişiklikleriniz kaydedilmedi. Onları kurtarmak istiyor musun?"},Ye={ar:ke,bg:Pe,cs:be,de:Se,es:Me,fr:xe,gl:Le,he:ze,it:Te,pl:Ne,ru:De,sk:Ee,sq:Ae,tr:je};const q="text-editor",Fe=[{path:"/:driveAliasAndItem(.*)?",component:we,name:"text-editor",meta:{authContext:"hybrid",title:"Text Editor",patchCleanPath:!0}}],Je=()=>{const e=[{extension:"txt",label:"Plain text file"},{extension:"md",label:"Markdown file"},{extension:"js",label:"JavaScript file"},{extension:"json",label:"JSON file"},{extension:"xml",label:"XML file"},{extension:"py",label:"Python file"},{extension:"php",label:"PHP file"},{extension:"yaml",label:"YAML file"}];let i=window.__$store.getters.extensionConfigByAppId(q).primaryExtensions||["txt","md"];return typeof i=="string"&&(i=[i]),e.reduce((o,n)=>{const p=i.includes(n.extension);return n.canBeDefault=p,p&&(n.newFileMenu={menuTitle(k){return k(n.label)}}),o.push(n),o},[])},Ce={name:"Text Editor",id:q,icon:"file-text",isFileEditor:!0,extensions:Je().map(e=>({extension:e.extension,...Object.prototype.hasOwnProperty.call(e,"newFileMenu")&&{newFileMenu:e.newFileMenu},...Object.prototype.hasOwnProperty.call(e,"canBeDefault")&&{canBeDefault:e.canBeDefault}}))},Xe={appInfo:Ce,routes:Fe,translations:Ye};export{Xe as default};
