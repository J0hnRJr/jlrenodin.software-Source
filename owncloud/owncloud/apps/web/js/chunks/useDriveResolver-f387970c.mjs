import{c as F,a as $,u as M}from"./useAuthService-746ac4ed.mjs";import{E as I,K as a,ag as q,Y as K,p as G,G as k,D as L}from"./vendor-2c44cb30.mjs";import{d as c,i as y,u as S,j as J,f as V,g as H,s as Y,c as E,e as Z}from"./eventBus-bf81ca73.mjs";import{u as x}from"./useStore-acb4016c.mjs";const Re=(e,t)=>{const s=F();return I({get(){return C(a(s.currentRoute).params[e])||t},async set(i){a(s.currentRoute).params[e]!==i&&await s.replace({params:{...a(s.currentRoute).params,[e]:i}})}})},_=(e,t)=>{const s=F();return I({get(){return a(s.currentRoute).query[e]||t},async set(i){a(s.currentRoute).query[e]!==i&&await s.replace({path:a(s.currentRoute).path,query:{...a(s.currentRoute).query,[e]:i}})}})};function X(e,t=""){return"/"+`public-files/${e}/${t}`.split("/").filter(Boolean).join("/")}const ee={complex:["tar.bz2","tar.gz",".tar.xz"]};function se(e,t){return S("spaces",e,t,{leadingSlash:!0})}function te(e,t=""){return S("spaces","trash-bin",e,t,{leadingSlash:!0})}const O=e=>e.replace(/[^A-Za-z0-9\-_]/g,""),U=(e,t)=>!e||typeof e!="string"?"":e.indexOf("!")>=0?e.split("!")[t]:"",ne=e=>U(e,0),A=e=>U(e,1),De=e=>{const t=e.extension||"",s=e.name||"";if(!t.length)return s;const i=s.lastIndexOf(`.${t}`);return s.substring(0,i)},ie=e=>{const t=e.name;if(e.type==="dir"||e.type==="folder"||e.isFolder)return"";const s=t.split(".");if(s.length>2)for(let i=0;i<s.length;i++){const r=s.slice(i,s.length).join(".");if(ee.complex.includes(r))return r}return s.length<2?"":s[s.length-1]};function Pe(e){const t=e.fileInfo[c.Name]||q(e.name),s=e.type==="dir"||e.type==="folder",i=ie({...e,name:t});let r;e.name.startsWith("/files")||e.name.startsWith("/space")?r=e.name.split("/").slice(3).join("/"):r=e.name,r.startsWith("/")||(r=`/${r}`);const l=e.fileInfo[c.FileId],p={id:l,fileId:l,storageId:ne(l),parentFolderId:e.fileInfo[c.FileParent],mimeType:e.fileInfo[c.MimeType],name:t,extension:s?"":i,path:r,webDavPath:e.name,type:s?"folder":e.type,isFolder:s,processing:e.processing||!1,mdate:e.fileInfo[c.LastModifiedDate],size:s?e.fileInfo[c.ContentSize]:e.fileInfo[c.ContentLength],indicators:[],permissions:e.fileInfo[c.Permissions]||"",starred:e.fileInfo[c.IsFavorite]!=="0",etag:e.fileInfo[c.ETag],sharePermissions:e.fileInfo[c.SharePermissions],shareTypes:function(){return e.fileInfo[c.ShareTypes]?e.fileInfo[c.ShareTypes].map(m=>parseInt(m)):[]}(),privateLink:e.fileInfo[c.PrivateLink],downloadURL:e.fileInfo[c.DownloadURL],shareId:e.fileInfo[c.ShareId],shareRoot:e.fileInfo[c.ShareRoot],ownerId:e.fileInfo[c.OwnerId],ownerDisplayName:e.fileInfo[c.OwnerDisplayName],tags:(e.fileInfo[c.Tags]||"").split(",").filter(Boolean),canUpload:function(){return this.permissions.indexOf(y.FolderCreateable)>=0},canDownload:function(){return!0},canBeDeleted:function(){return this.permissions.indexOf(y.Deletable)>=0},canRename:function(){return this.permissions.indexOf(y.Renameable)>=0},canShare:function(){return this.permissions.indexOf(y.Shareable)>=0},canCreate:function(){return this.permissions.indexOf(y.FolderCreateable)>=0},canEditTags:function(){return this.permissions.indexOf(y.Updateable)>=0||this.permissions.indexOf(y.FileUpdateable)>=0},isMounted:function(){return this.permissions.indexOf(y.Mounted)>=0},isReceivedShare:function(){return this.permissions.indexOf(y.Shared)>=0},canDeny:function(){return this.permissions.indexOf(y.Deny)>=0},getDomSelector:()=>O(l)};return Object.defineProperty(p,"nodeId",{get(){return A(this.id)}}),p}const ae="a0ca6a90-a365-4782-871e-d44447bbc668",xe=e=>e.driveType==="personal",Ce=e=>e.driveType==="project",re=e=>(e==null?void 0:e.driveType)==="share",Te=e=>e.driveType==="mountpoint",we=e=>e.driveType==="public";function ke(e){var m,h,f,g,d;const t=e.publicLinkPassword,s=(m=e.fileInfo)==null?void 0:m[c.PublicLinkItemType],i=(h=e.fileInfo)==null?void 0:h[c.PublicLinkPermission],r=(f=e.fileInfo)==null?void 0:f[c.PublicLinkExpiration],l=(g=e.fileInfo)==null?void 0:g[c.PublicLinkShareDate],p=(d=e.fileInfo)==null?void 0:d[c.PublicLinkShareOwner];return Object.assign(j({...e,driveType:"public",driveAlias:`public/${e.id}`,webDavPath:X(e.id)}),{...t&&{publicLinkPassword:t},...s&&{publicLinkItemType:s},...i&&{publicLinkPermission:parseInt(i)},...r&&{publicLinkExpiration:r},...l&&{publicLinkShareDate:l},...p&&{publicLinkShareOwner:p}})}function oe({shareId:e,shareName:t,serverUrl:s}){const i=j({id:[ae,e].join("!"),driveAlias:`share/${t}`,driveType:"share",name:t,shareId:e,serverUrl:s});return i.rename=r=>{i.driveAlias=`share/${r}`,i.name=r},i}function j(e){var g,d,v,b,R,D;let t,s,i=!1;const r=Object.fromEntries(J.list().map(n=>[n.name,[]]));if(e.special&&(t=e.special.find(n=>n.specialFolder.name==="image"),s=e.special.find(n=>n.specialFolder.name==="readme"),t&&(t.webDavUrl=decodeURI(t.webDavUrl)),s&&(s.webDavUrl=decodeURI(s.webDavUrl))),(g=e.root)!=null&&g.permissions){for(const n of e.root.permissions)r[n.roles[0]].push(...n.grantedToIdentities.reduce((o,P)=>{const T=P.hasOwnProperty("group")?"group":"user",z={kind:T,id:P[T].id,displayName:P[T].displayName,expirationDate:n.expirationDateTime,isMember(w){if(!w)return!1;switch(this.kind){case"user":return this.id==w.uuid;case"group":return w.groups.map(B=>B.id).includes(this.id);default:return!1}}};return[...o,z]},[]));(d=e.root)!=null&&d.deleted&&(i=((v=e.root.deleted)==null?void 0:v.state)==="trashed")}const l=S(e.webDavPath||se(e.id),{leadingSlash:!0}),p=S(e.serverUrl,"remote.php/dav",l),m=S(e.webDavTrashPath||te(e.id),{leadingSlash:!0}),h=S(e.serverUrl,"remote.php/dav",m),f={id:e.id,fileId:e.id,storageId:e.id,mimeType:"",name:e.name,description:e.description,extension:"",path:"/",webDavPath:l,webDavTrashPath:m,driveAlias:e.driveAlias,driveType:e.driveType,type:"space",isFolder:!0,mdate:e.lastModifiedDateTime,size:(b=e.quota)==null?void 0:b.used,indicators:[],tags:[],permissions:"",starred:!1,etag:"",shareId:e.shareId,sharePermissions:"",shareTypes:function(){return[]}(),privateLink:"",downloadURL:"",ownerDisplayName:"",ownerId:(D=(R=e.owner)==null?void 0:R.user)==null?void 0:D.id,disabled:i,root:e.root,spaceQuota:e.quota,spaceRoles:r,spaceImageData:t,spaceReadmeData:s,canUpload:function({user:n}={}){return this.isManager(n)||this.isEditor(n)},canDownload:function(){return!0},canBeDeleted:function({user:n,ability:o}={}){return this.disabled&&((o==null?void 0:o.can("delete-all","Drive"))||this.isManager(n))},canRename:function({user:n,ability:o}={}){return(o==null?void 0:o.can("update-all","Drive"))||this.isManager(n)},canEditDescription:function({user:n,ability:o}={}){return(o==null?void 0:o.can("update-all","Drive"))||this.isManager(n)},canRestore:function({user:n,ability:o}={}){return this.disabled&&((o==null?void 0:o.can("update-all","Drive"))||this.isManager(n))},canDisable:function({user:n,ability:o}={}){return!this.disabled&&((o==null?void 0:o.can("delete-all","Drive"))||this.isManager(n))},canShare:function({user:n}={}){return this.isManager(n)},canEditImage:function({user:n}={}){return!this.disabled&&(this.isManager(n)||this.isEditor(n))},canEditReadme:function({user:n}={}){return this.isManager(n)||this.isEditor(n)},canCreate:function(){return!0},canEditTags:function(){return!1},isMounted:function(){return!0},isReceivedShare:function(){return!1},canDeny:()=>!1,getDomSelector:()=>O(e.id),getDriveAliasAndItem({path:n}){return S(this.driveAlias,n,{leadingSlash:!1})},getWebDavUrl({path:n}){return S(p,n)},getWebDavTrashUrl({path:n}){return S(h,n)},isViewer(n){return this.spaceRoles[V.name].map(o=>o.isMember(n)).some(Boolean)},isEditor(n){return this.spaceRoles[H.name].map(o=>o.isMember(n)).some(Boolean)},isManager(n){return this.spaceRoles[Y.name].map(o=>o.isMember(n)).some(Boolean)},isMember(n){return this.isViewer(n)||this.isEditor(n)||this.isManager(n)}};return Object.defineProperty(f,"nodeId",{get(){return A(this.id)}}),f}const le=(e,t,s)=>{var r,l;const i=(s==null?void 0:s.configurationManager)||E;return{params:{driveAliasAndItem:e.getDriveAliasAndItem({path:t.path||""})},query:{...re(e)&&{shareId:e.shareId},...((l=(r=i==null?void 0:i.options)==null?void 0:r.routing)==null?void 0:l.idBased)&&!K(t.fileId)&&{fileId:`${t.fileId}`}}}},ue=(e={})=>{const t=e.router||F(),s=e.configurationManager||$();return{replaceInvalidFileRoute:({space:r,resource:l,path:p,fileId:m})=>{var f,g;if(!((g=(f=s==null?void 0:s.options)==null?void 0:f.routing)!=null&&g.idBased)||p===l.path&&m===l.fileId)return!1;const h=le(r,l,{configurationManager:s});return t.replace(h),!0}}},N="contextRouteName",W="contextRouteParams",Q="contextRouteQuery",Fe=e=>{var l;const{params:t,query:s}=e,i={},r=["fileId","shareId"].concat(((l=e.meta)==null?void 0:l.contextQueryItems)||[]);for(const p of r)i[p]=s[p];return{[N]:e.name,[W]:t,[Q]:i}},Le=e=>({routeName:C(e[N]),routeParams:e[W],routeQuery:e[Q]}),C=e=>Array.isArray(e)?e[0].toString():e==null?void 0:e.toString();function _e({router:e,currentFileContext:t}){const s=p=>{const{fileName:m,routeName:h,routeParams:f,routeQuery:g}=a(p);return a(h)?e.push({name:a(h),params:a(f),query:{...a(g),scrollTo:a(m)}}):e.push({path:"/"})},{replaceInvalidFileRoute:i}=ue({router:e});return{replaceInvalidFileRoute:(p,m)=>{const h=a(p);return i({space:a(h.space),resource:m,path:a(h.item),fileId:a(h.itemId)})},closeApp:()=>s(t)}}const ce=(e,t,s)=>I(()=>{const i=G(e,`getters.capabilities.${t}`,s);if(i===void 0)throw new Error("useCapability: capability is not defined and no default was provided");return i}),u=(e,t)=>s=>ce(s||x(),e,t),Me=u("core.support-url-signing",!1),Ee=u("graph.personal-data-export",!1),Oe=u("files_sharing.quick_link.default_role","viewer"),Ue=u("files_sharing.resharing",!0),Ae=u("files_sharing.resharing_default",!0),pe=u("spaces.enabled",!1),je=u("spaces.max_quota",0),Ne=u("spaces.projects",!1),We=u("spaces.share_jail",!1),Qe=u("graph.users.read_only_attributes",[]),ze=u("graph.users.create_disabled",!1),Be=u("graph.users.delete_disabled",!1),$e=u("graph.users.change_password_self_disabled",!0),qe=u("files.favorites",!1),Ke=u("files.tus_support.http_method_override",!1),Ge=u("files.tus_support.max_chunk_size",0),Je=u("files.tus_support.extension",""),Ve=u("files.permanent_deletion",!0),He=u("files.tags",!1),Ye=u("files.privateLinks",!1),Ze=u("files.app_providers",[]),Xe=u("files_sharing.deny_access",!1),es=u("files_sharing.can_rename",!0),ss=u("files_sharing.allow_custom",!0),ts=u("files_sharing.public.can_edit",!1),ns=u("files_sharing.public.can_contribute",!0),is=u("files_sharing.public.alias",!1),as=u("notifications.ocs-endpoints",[]),de=()=>Z;function rs({titleSegments:e,store:t,eventBus:s}){t=t||x(),s=s||de(),k(e,i=>{const r=a(i),l=" - ",p=t.getters.configuration.currentTheme.general.name,m={shortDocumentTitle:r.join(l),fullDocumentTitle:[...r,p].join(l)};s.publish("runtime.documentTitle.changed",m)},{immediate:!0,deep:!0})}const fe=({store:e})=>I(()=>e.getters["runtime/auth/accessToken"]),he=({store:e})=>I(()=>e.getters["runtime/auth/isPublicLinkContextReady"]),me=({store:e})=>I(()=>e.getters["runtime/auth/publicLinkPassword"]),ge=({store:e})=>I(()=>e.getters["runtime/auth/publicLinkToken"]);function os(e={}){var h,f;const t=(h=e.clientService)!=null?h:M(),s=(f=e.store)!=null?f:x(),i=he({store:s}),r=me({store:s}),l=fe({store:s}),p=ge({store:s});return{makeRequest:(g,d,v={})=>{const b=a(l)?t.httpAuthenticated:t.httpUnAuthenticated;return v.headers=v.headers||{},a(i)&&(a(r)&&(v.headers.Authorization="Basic "+Buffer.from(["public",a(r)].join(":")).toString("base64")),a(p)&&(v.headers["public-token"]=a(p))),v.method=g,v.url=d,b.request(v)}}}const be=e=>{const t=(e==null?void 0:e.store)||x();return{areSpacesLoading:I(()=>!t.getters["runtime/spaces/spacesInitialized"]||t.getters["runtime/spaces/spacesLoading"])}},ls=(e={})=>{const t=e.store||x(),{areSpacesLoading:s}=be({store:t}),i=_("shareId"),r=_("fileId"),l=I(()=>C(a(r))),p=pe(t),m=M(),h=I(()=>t.getters["runtime/spaces/spaces"]),f=L(null),g=L(null);return k([e.driveAliasAndItem,s],([d])=>{if(!d||d.startsWith("virtual/")){f.value=null,g.value=null;return}if(a(f)&&d.startsWith(a(f).driveAlias)){g.value=S(d.slice(a(f).driveAlias.length),{leadingSlash:!0});return}let b=null,R=null;const D=d.split("/");if(d.startsWith("public/")){const[n,...o]=d.split("/").slice(1);b=a(h).find(P=>P.id===n),R=o.join("/")}else if(d.startsWith("share/")){const[n,...o]=d.split("/").slice(1);b=oe({shareId:C(a(i)),shareName:a(n),serverUrl:E.serverUrl}),R=o.join("/")}else a(p)&&a(l)?b=a(h).find(n=>a(l).startsWith(`${n.fileId}`)):b=a(h).find(n=>{if(!d.startsWith(n.driveAlias))return!1;const o=n.driveAlias.split("/");return D.length<o.length||D.slice(0,o.length).join("/")!==n.driveAlias?!1:n}),b&&(R=d.slice(b.driveAlias.length));f.value=b,g.value=S(R,{leadingSlash:!0})},{immediate:!0,deep:!0}),k(f,d=>{if(!(!d||["public","share","personal"].includes(d.driveType)))return t.dispatch("runtime/spaces/loadSpaceMembers",{graphClient:m.graphAuthenticated,space:d})},{immediate:!0}),{space:f,item:g,itemId:l}};export{ls as $,ze as A,Be as B,Ze as C,qe as D,Ve as E,ss as F,Xe as G,es as H,is as I,ns as J,ts as K,Oe as L,Ue as M,Ae as N,He as O,Je as P,Ke as Q,Ge as R,ae as S,Ee as T,as as U,Ye as V,Ne as W,Qe as X,We as Y,pe as Z,je as _,Pe as a,he as a0,me as a1,ge as a2,os as a3,Re as a4,_ as a5,be as a6,le as a7,ue as a8,rs as a9,ke as b,oe as c,j as d,X as e,se as f,te as g,O as h,ie as i,De as j,A as k,ne as l,Te as m,xe as n,Ce as o,we as p,re as q,Le as r,N as s,C as t,Fe as u,fe as v,_e as w,ce as x,$e as y,Me as z};
