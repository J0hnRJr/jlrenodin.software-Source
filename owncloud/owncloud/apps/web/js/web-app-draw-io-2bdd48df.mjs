import{d as c,b5 as h,K as m,U as w,aX as g,ag as p,g as f,h as v,o,c as t,f as D,e as s,w as y}from"./chunks/vendor-2c44cb30.mjs";import{d as n,i as d,_ as b}from"./chunks/eventBus-bf81ca73.mjs";import{a as k}from"./chunks/useAppDefaults-324f07ea.mjs";import{u as E}from"./chunks/useStore-acb4016c.mjs";import"./chunks/useAuthService-746ac4ed.mjs";import"./chunks/useDriveResolver-f387970c.mjs";const T={"Diagram imported":"تم استيراد الرسم البياني","Loading media":"يتم الآن تحميل الوسائط"},F={"An error occurred":"Възникна грешка","Couldn't save. Error when contacting the server":"Неуспешно запазване. Грешка при свързването със сървъра","Diagram imported":"Диаграмата е импортирана","Draw.io document":"Draw.io документ","Draw.io editor":"Draw.io редактор","File saved!":"Файлът е запазен!","Loading media":"Зареждане на медия","Saving error. You're not authorized to save this file":"Грешка при запазване. Нямате необходимите права, за да запазите този файл","The diagram was successfully saved":"Диаграмата е запазена успешно","The diagram will open as a new .drawio file: %{file}":"Диаграмата ще се отвори като нов .drawio файл: %{file}","This file was updated outside this window. Please refresh the page. All changes will be lost, so download a copy first.":"Този файл е актуализиран извън този прозорец. Моля, презаредете страницата. Но първо изтеглете копие, защото всички промени ще бъдат загубени."},C={"An error occurred":"Objevila se chyba","Couldn't save. Error when contacting the server":"Nepodařilo se uložit. Chyba při kontaktování serveru","Diagram imported":"Diagram importován","Draw.io document":"Draw.io dokument","Draw.io editor":"Editor Draw.io","File saved!":"Soubor uložen!","Loading media":"Načítání medií","Saving error. You're not authorized to save this file":"Chyba ukládání. K uložení tohoto souboru nemáte oprávnění","The diagram was successfully saved":"Diagram byl úspěšně uložen","The diagram will open as a new .drawio file: %{file}":"Diagram se otevře jako nový soubor .drawio: %{file}","This file was updated outside this window. Please refresh the page. All changes will be lost, so download a copy first.":"Tento soubor byl aktualizován mimo toto okno. Obnovte prosím stránku. Všechny změny budou ztraceny, proto si nejprve stáhněte kopii."},x={"An error occurred":"Ein Fehler ist aufgetreten","Couldn't save. Error when contacting the server":"Speichern nicht möglich. Fehler beim Kontaktieren des Servers","Diagram imported":"Diagramm importiert","Draw.io document":"Draw.io-Datei","Draw.io editor":"Draw.io Editor","File saved!":"Datei gespeichert!","Loading media":"Lade Daten","Saving error. You're not authorized to save this file":"Fehler beim Speichern. Keine ausreichenden Berechtigungen, um die Datei zu speichern","The diagram was successfully saved":"Das Diagram wurde erfolgreich gespeichert","The diagram will open as a new .drawio file: %{file}":"Das Diagramm wird als neue .drawio Datei geöffnet: %{file}","This file was updated outside this window. Please refresh the page. All changes will be lost, so download a copy first.":"Die Datei wurde außerhalb dieses Fensters aktualisiert. Bitte laden Sie die Seite neu. Alle Änderungen gehen dabei verloren. Laden Sie deshalb zuerst eine Kopie herunter."},A={"An error occurred":"Ocurrió un error","Couldn't save. Error when contacting the server":"No se puede guardar. Error al contactar con el servidor","Diagram imported":"Diagrama importado","Draw.io document":"Documento  Draw.io","Draw.io editor":"Editor Draw.io","File saved!":"Archivo guardado!","Loading media":"Cargando medios","Saving error. You're not authorized to save this file":"Error al guardar. No tienes permiso para guardar este archivo.","The diagram was successfully saved":"El diagrama se guardó correctamente","The diagram will open as a new .drawio file: %{file}":"El diagrama se abrirá como un nuevo archivo .drawio : %{file}","This file was updated outside this window. Please refresh the page. All changes will be lost, so download a copy first.":"Este archivo fue actualizado fuera de esta ventana. Actualiza la página. Todos los cambios se perderán, así que primero guarda una copia."},P={"An error occurred":"Une erreur est survenue","Couldn't save. Error when contacting the server":"Enregistrement impossible. Erreur de communication avec le serveur","Diagram imported":"Diagramme importé","Draw.io document":"Document Draw.io","Draw.io editor":"Éditeur Draw.io","File saved!":"Fichier enregistré !","Loading media":"Chargement du media","Saving error. You're not authorized to save this file":"Erreur d'enregistrement. Vous n'êtes pas autorisé à enregistrer ce fichier","The diagram was successfully saved":"Le diagramme a bien été enregistré","The diagram will open as a new .drawio file: %{file}":"Le diagramme va s'ouvrir comme un nouveau fichier .drawio : %{file}","This file was updated outside this window. Please refresh the page. All changes will be lost, so download a copy first.":"Ce fichier a été modifié en dehors de cette fenêtre. Veuillez rafraîchir la page. Tous les changements seront perdus, téléchargez-en une copie avant."},S={},z={"An error occurred":"אירעה שגיאה","Couldn't save. Error when contacting the server":"לא ניתן לשמור. שגיאה ביצירת קשר עם השרת","Diagram imported":"תרשים עבר ייבוא","Draw.io document":"מסמך Draw.io","Draw.io editor":"עורך Draw.io","File saved!":"קובץ נשמר!","Loading media":"מדיה נטענת","Saving error. You're not authorized to save this file":"שגיאת שמירה. אין לך הרשה לשמור את הקובץ הזה","The diagram was successfully saved":"התרשים נשמר בהצלחה","The diagram will open as a new .drawio file: %{file}":"התרשים ייפתח כקובץ ‎.drawio חדש: %{file}","This file was updated outside this window. Please refresh the page. All changes will be lost, so download a copy first.":"הקובץ עודכן מחוץ לחלון הזה. נא לרענן את העמוד. כל השינויים יאבדו, לכן כדאי להוריד עותק תחילה."},_={"Diagram imported":"Diagramma importato","Draw.io document":"Documento Draw.io","Draw.io editor":"Editor Draw.io","File saved!":"File salvato!","Loading media":"Caricamento media","Saving error. You're not authorized to save this file":"Errore di salvataggio. L'utente non è autorizzato a salvare questo file","The diagram will open as a new .drawio file: %{file}":"Il diagramma verrà aperto come nuovo file .drawio: %{file}"},$={"An error occurred":"Wystąpił błąd","Couldn't save. Error when contacting the server":"Zapis nieudany. Błąd kontaktu z serwerem","Draw.io document":"Dokument Draw.io","Draw.io editor":"Edytor Draw.io","File saved!":"Plik zapisany!","Loading media":"Ładowanie utworu","Saving error. You're not authorized to save this file":"Błąd zapisu. Nie masz uprawnień do zapisywania tego pliku"},L={"An error occurred":"Произошла ошибка","Couldn't save. Error when contacting the server":"Не удалось сохранить. Ошибка при обращении к серверу","Diagram imported":"Диаграмма импортирована","Draw.io document":"Draw.io документ","Draw.io editor":"Draw.io редактор","File saved!":"Файл сохранен!","Loading media":"Загрузка медиа","Saving error. You're not authorized to save this file":"Ошибка сохранения. У вас нет прав для сохранения этого файла","The diagram was successfully saved":"Диаграмма успешно сохранена","The diagram will open as a new .drawio file: %{file}":"Диаграма будет открыта как новый .drawio файл: %{file}","This file was updated outside this window. Please refresh the page. All changes will be lost, so download a copy first.":"Этот файл был обновлен за пределами этого окна. Пожалуйста, обновите страницу. Все изменения будут потеряны, поэтому сначала скачайте копию."},j={"Couldn't save. Error when contacting the server":"Nepodarilo sa uložiť. Chyba pri kontaktovaní servera.","Diagram imported":"Diagram importovaný","Draw.io document":"Dokument draw.io","Draw.io editor":"Editor draw.io","File saved!":"Súbor uložený!","Loading media":"Načítanie média","Saving error. You're not authorized to save this file":"Chyba pri ukladaní. Nemáte práva na uloženie tohoto súboru.","The diagram will open as a new .drawio file: %{file}":"Diagram sa otvorí ako nový .drawio súbor: %{file}","This file was updated outside this window. Please refresh the page. All changes will be lost, so download a copy first.":"Tento súbor bol upravený v inom okne. Prosím obnovte stránku. Všetky zmeny sa stratia, takže si najprv stiahnite kópiu."},N={"An error occurred":"Ndodhi një gabim","Couldn't save. Error when contacting the server":"S’u bë dot ruajtje. Gabim kur lidhet me shërbyesin","Diagram imported":"Diagrami u importua","Draw.io document":"Dokument Draw.io","Draw.io editor":"Përpunuesi Draw.io","File saved!":"Kartela u ruajt!","Loading media":"Po ngarkohet media","Saving error. You're not authorized to save this file":"Gabim ruajtjeje. S’jeni i autorizuar të ruani këtë kartelë","The diagram was successfully saved":"Diagrami u ruajt me sukses","The diagram will open as a new .drawio file: %{file}":"Diagrami do të hapet si një kartelë e re .drawio: %{file}","This file was updated outside this window. Please refresh the page. All changes will be lost, so download a copy first.":"Kjo kartelë qe përditësuar jashtë kësaj dritareje. Ju lutemi, rifreskoni faqen. Krejt ndryshimet do të humbin, ndaj, më parë, shkarkoni një kopje."},Y={"An error occurred":"Bir hata oluştu","Couldn't save. Error when contacting the server":"Kaydedilemedi. Sunucuyla iletişim kurulurken hata","Diagram imported":"Diyagram içe aktarıldı","Draw.io document":"Draw.io dokümanı","Draw.io editor":"Draw.io editörü","File saved!":"Dosya kaydedildi!","Loading media":"Medya yükleniyor","Saving error. You're not authorized to save this file":"Kaydetme hatası. Bu dosyayı kaydetme yetkiniz yok","The diagram was successfully saved":"Diyagram başarıyla kaydedildi","The diagram will open as a new .drawio file: %{file}":"Diyagram yeni bir .drawio dosyası olarak açılacaktır: %{file}","This file was updated outside this window. Please refresh the page. All changes will be lost, so download a copy first.":"Bu dosya, bu pencerenin dışında güncellendi. Lütfen sayfayı yenileyin. Tüm değişiklikler kaybolacak, bu yüzden önce bir kopyasını indirin."},I={ar:T,bg:F,cs:C,de:x,es:A,fr:P,gl:S,he:z,it:_,pl:$,ru:L,sk:j,sq:N,tr:Y},M=c({name:"DrawIoEditor",setup(){const a=E().getters.configuration.options.editor.autosaveEnabled;return{...k({applicationId:"draw-io"}),isAutoSaveEnabled:a}},data:()=>({loading:!0,filePath:"",fileExtension:"",isReadOnly:null,currentETag:null}),computed:{config(){const{url:e="https://embed.diagrams.net",theme:a="minimal"}=this.applicationConfig;return{url:e,theme:a}},urlHost(){const e=new URL(this.config.url),a=`${e.protocol}//${e.hostname}`;return e.port?`${a}:${e.port}`:a},iframeSource(){const e=h.stringify({embed:1,chrome:this.isReadOnly?0:1,picker:0,stealth:1,spin:1,proto:"json",ui:this.config.theme});return`${this.config.url}?${e}`}},watch:{currentFileContext:{handler:function(){this.checkPermissions()},immediate:!0}},created(){this.filePath=m(this.currentFileContext.path),this.fileExtension=this.filePath.split(".").pop(),window.addEventListener("message",this.handleMessage)},beforeUnmount(){window.removeEventListener("message",this.handleMessage)},methods:{...w(["showMessage"]),errorPopup(e){this.showMessage({title:this.$gettext("An error occurred"),desc:e,status:"danger"})},successPopup(e){this.showMessage({title:this.$gettext("The diagram was successfully saved"),desc:e,status:"success"})},errorNotification(e){this.$refs.drawIoEditor.contentWindow.postMessage(JSON.stringify({action:"status",message:e,modified:!1}),this.urlHost)},async checkPermissions(){try{const e=await this.getFileInfo(this.currentFileContext,{davProperties:[n.FileId,n.Permissions]});this.replaceInvalidFileRoute(this.currentFileContext,e),this.isReadOnly=![d.Updateable,d.FileUpdateable].some(a=>(e.permissions||"").indexOf(a)>-1),this.loading=!1}catch(e){this.errorPopup(e)}},async handleMessage(e){if(e.data.length>0){if(e.origin!==this.config.url)return;const a=JSON.parse(e.data);switch(a.event){case"init":this.fileExtension==="vsdx"?this.importVisio():this.load();break;case"autosave":this.isAutoSaveEnabled&&this.save(a,!0);break;case"save":this.save(a);break;case"exit":this.exit();break}}},async loadFileContent(){try{const e=await this.getFileContents(this.currentFileContext);this.currentETag=e.headers.ETag,this.$refs.drawIoEditor.contentWindow.postMessage(JSON.stringify({action:"load",xml:e.body,autosave:this.isAutoSaveEnabled}),this.urlHost)}catch(e){this.errorPopup(e)}},async load(){await Promise.all([this.checkPermissions(),this.loadFileContent()])},importVisio(){const e=()=>this.$gettextInterpolate(this.$gettext("The diagram will open as a new .drawio file: %{file}"),{file:p(this.filePath)},!0);this.filePath+=`_${this.getTimestamp()}.drawio`,this.showMessage({title:this.$gettext("Diagram imported"),desc:e()}),this.getFileContents(this.currentFileContext,{responseType:"arrayBuffer"}).then(a=>a.body).then(a=>{const r=new Blob([a],{type:"application/vnd.visio"}),i=new FileReader;i.onloadend=()=>{this.$refs.drawIoEditor.contentWindow.postMessage(JSON.stringify({action:"load",xml:i.result,autosave:this.isAutoSaveEnabled}),this.urlHost)},i.readAsDataURL(r)}).catch(a=>{this.errorPopup(a)})},save(e,a=!1){this.putFileContents(this.currentFileContext,{content:e.xml,previousEntityTag:this.currentETag}).then(r=>{this.currentETag=r.etag;const i=this.$gettext("File saved!");a?this.$refs.drawIoEditor.contentWindow.postMessage(JSON.stringify({action:"status",message:i,modified:!1}),this.urlHost):this.successPopup(i)}).catch(r=>{const i=a?this.errorNotification:this.errorPopup;switch(r.statusCode){case 412:i(this.$gettext("This file was updated outside this window. Please refresh the page. All changes will be lost, so download a copy first."));break;case 500:i(this.$gettext("Couldn't save. Error when contacting the server"));break;case 401:i(this.$gettext("Saving error. You're not authorized to save this file"));break;default:i(r.message||r)}})},exit(){window.close()},getTimestamp(){return g.local().toFormat("YYYYMMDD[T]HHmmss")}}});const O={key:0,class:"oc-position-center"},B={class:"oc-invisible"},K=["src","title"];function H(e,a,r,i,U,J){const l=f("oc-spinner"),u=v("translate");return o(),t("main",null,[e.loading?(o(),t("div",O,[D(l,{size:"xlarge"}),s(),y((o(),t("p",B,[s("Loading media")])),[[u]])])):(o(),t("iframe",{key:1,id:"drawio-editor",ref:"drawIoEditor",src:e.iframeSource,title:e.$gettext("Draw.io editor")},null,8,K))])}const V=b(M,[["render",H],["__scopeId","data-v-e53482d4"]]),q=[{name:"draw-io",path:"/:driveAliasAndItem(.*)?",component:V,meta:{authContext:"hybrid",patchCleanPath:!0}}],R={name:"Draw.io",id:"draw-io",icon:"grid",extensions:[{extension:"drawio",routeName:"draw-io",newFileMenu:{menuTitle(e){return e("Draw.io document")}}},{extension:"vsdx",routeName:"draw-io"}]},ae={appInfo:R,routes:q,translations:I};export{ae as default};
